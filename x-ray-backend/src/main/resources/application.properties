# Quarkus Application Configuration
quarkus.application.name=x-ray-backend

# HTTP Configuration for Lambda
quarkus.http.root-path=/

# Tell Quarkus Lambda which handler bean to use
quarkus.lambda.handler=alb

# Lambda Configuration
# Handler is auto-configured by quarkus-amazon-lambda-http extension

# OpenTelemetry Configuration for AWS X-Ray via ADOT Collector
# The ADOT Lambda layer collector listens on localhost:4317
quarkus.otel.exporter.otlp.endpoint=http://localhost:4317
quarkus.otel.exporter.otlp.protocol=grpc
quarkus.otel.traces.exporter=otlp
quarkus.otel.metrics.exporter=none
quarkus.otel.logs.exporter=none

# OTLP exporter timeout configuration for Lambda
quarkus.otel.exporter.otlp.timeout=10s

# Batch span processor configuration
# Export spans more quickly in Lambda environment
quarkus.otel.bsp.schedule.delay=100ms
quarkus.otel.bsp.max.export.batch.size=512
quarkus.otel.bsp.export.timeout=30s

# X-Ray specific configuration
# Use xray propagator for X-Ray trace header format, with standard propagators
quarkus.otel.propagators=xray,tracecontext,baggage
# Always sample - let X-Ray make the sampling decision
quarkus.otel.traces.sampler=always_on

# AWS X-Ray resource attributes
quarkus.otel.resource.attributes=service.name=x-ray-backend,service.version=1.0.0

# Enable tracing
quarkus.otel.sdk.disabled=false

# Logging Configuration
quarkus.log.level=INFO
quarkus.log.category."com.example.xray".level=DEBUG
quarkus.log.category."io.opentelemetry".level=DEBUG

# Enable JSON logging with trace context
quarkus.log.console.json=true
quarkus.log.console.json.additional-field."service.name".value=x-ray-backend
quarkus.log.console.json.additional-field."service.version".value=1.0.0

# Include OpenTelemetry trace context in logs
# This adds trace_id and span_id to MDC which will be included in JSON logs
quarkus.opentelemetry.tracer.exporter.otlp.endpoint=http://localhost:4317

# Lambda-specific environment variable overrides
# These will be set by Lambda runtime or Terraform
%prod.quarkus.otel.exporter.otlp.endpoint=${OTEL_EXPORTER_OTLP_ENDPOINT:http://localhost:4317}
%prod.quarkus.otel.resource.attributes=service.name=x-ray-backend,service.version=1.0.0,cloud.provider=aws,cloud.platform=aws_lambda
